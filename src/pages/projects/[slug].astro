---
import {getCollection} from "astro:content";
import {Markdown} from "@astropub/md";
import {Picture} from "@astrojs/image/components";
import {parseNumber, parseTime} from "@utils/parse";
import {getViews} from "@utils/redis";

import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";
import Icon from "astro-icon";

export const prerender = true;

export async function getStaticPaths() {
  const projectEntries = await getCollection("projects");
  return projectEntries.map((entry) => ({
    params: {slug: entry.slug},
    props: {entry},
  }));
}

const {entry} = Astro.props;
const {slug} = Astro.params;
const views = await getViews(slug as string);
---

<Layout title={entry.data.title}>
  <Container>
    <div class="meta">
      <div class="meta-title">
        <h1 class="text-3xl font-bold">{entry.data.title}</h1>
        <div
          class="flex justify-between items-center mt-3 xsm:flex-col xsm:items-start">
          <p>{entry.data.snippet}</p>

          <div class="flex space-x-1 items-center">
            <time class="text-gray-400 text-sm font-sans meta-time">
              {parseTime(entry.data.createdDate)}
            </time>
            <div class="flex items-center space-x-1 text-gray-400">
              <div class="w-4 h-4 flex items-center">
                <Icon name="mdi:eye" />
              </div>
              <span class="text-[13px]">
                {parseNumber(views ?? 0)}
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="meta-image mt-10">
        <Picture
          src={entry.data.image.src}
          alt={entry.data.image.alt}
          sizes="(max-width: 800px) 100vw, 600px"
          widths={[200, 400, 600]}
          aspectRatio="16:9"
          format="webp"
          fit="cover"
          position="center"
          loading="eager"
          class="w-full rounded-md"
        />
      </div>
    </div>
    <div class="blog-prose mt-10">
      <Markdown of={entry.body} />
    </div>

    <script
      is:inline
      src="https://giscus.app/client.js"
      data-repo="ioofy/rizkyy.dev"
      data-repo-id="R_kgDOJ6KTcA"
      data-category="General"
      data-category-id="DIC_kwDOJ6KTcM4CX2nG"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="dark_high_contrast"
      data-lang="en"
      crossorigin="anonymous"
      async></script>
  </Container>
</Layout>

<link rel="stylesheet" href="/css/hljs-github-dark.css" />
<script src="/js/highlight.min.js" is:inline></script>
<script is:inline>
  hljs.highlightAll();
</script>
