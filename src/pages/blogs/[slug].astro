---
import {type z} from "astro:content";
import {type PostType, type PostDetailType, graphqlFetch} from "@utils/all";
import {postQuery, postDetailQuery} from "@graphql/query";
import {Markdown} from "@astropub/md";
import Container from "@components/container.astro";
import BlogLayout from "@layouts/BlogLayout.astro";
import {Picture} from "@astrojs/image/components";

type PostQueryType = z.infer<typeof PostType>;
type DetailPostQueryType = z.infer<typeof PostDetailType>;

export async function getStaticPaths() {
  const {data} = await graphqlFetch<PostQueryType>({
    query: postQuery,
  });

  return data.postsConnection.edges.map((item) => ({
    params: {slug: item.node.slug},
  }));
}

const {slug} = Astro.params;

const {
  data: {post},
} = await graphqlFetch<DetailPostQueryType>({
  query: postDetailQuery,
  variables: {slug},
});
---

<BlogLayout
  title={post.title}
  urlImage={post.thumbnailImage.url}
  description={post.excerpt}>
  <Container>
    <div class="mt-20 text-purple-400">
      {post.categories.map((item) => <span>#{item.name}</span>)}
    </div>
    <h1 class="text-4xl xsm:text-3xl mt-2">
      {post.title}
    </h1>
    <div class="meta mb-10">
      <div class="meta-content my-2 flex justify-between text-gray-400">
        <div class="meta-inline text-[15px]">
          Riz,
          <time class="meta-time"> Wed Aug 31 2022</time>
        </div>
        <a href="/blogs">Back</a>
      </div>
    </div>

    <div>
      <div class="meta-image">
        <Picture
          src={post.thumbnailImage.url}
          alt="meta-blog-image"
          sizes="(max-width: 800px) 100vw, 800px"
          widths={[200, 400, 800]}
          aspectRatio="16:9"
          format="webp"
          fit="cover"
          position="center"
          loading="eager"
          class="w-full rounded-md"
        />
      </div>
    </div>
    <div class="blog-prose mt-10">
      <Markdown of={post.content} />
    </div>
  </Container>
</BlogLayout>

<link rel="stylesheet" href="/css/hljs-github-dark.css" />
<script src="/js/highlight.min.js" is:inline></script>
<script is:inline>
  hljs.highlightAll();
</script>
